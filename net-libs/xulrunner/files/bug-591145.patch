# HG changeset patch
# Parent 83e9c68be99dc3a13080639d6f3d52ed30a0aa0c
# User Jory A. Pratt <anarchy@gentoo.org>
Remove option controlling which encoders are built

diff --git a/modules/libpr0n/build/Makefile.in b/modules/libpr0n/build/Makefile.in
--- a/modules/libpr0n/build/Makefile.in
+++ b/modules/libpr0n/build/Makefile.in
@@ -77,26 +77,10 @@ EXTRA_DSO_LDOPTS = \
 		$(LIBS_DIR) \
 		$(JPEG_LIBS) \
 		$(PNG_LIBS) $(ZLIB_LIBS) \
 		$(QCMS_LIBS) \
 		$(EXTRA_DSO_LIBS) \
 		$(MOZ_COMPONENT_LIBS) \
 		$(NULL)
 
-# Force a rebuild of nsImageModule when either of MOZ_IMG_{DE,EN}CODERS changes
-
-GARBAGE += _img_list nsImgBuildDefines.h
-
-export::
-	{ \
-	$(foreach d,$(MOZ_IMG_ENCODERS), \
-		echo "#define IMG_BUILD_ENCODER_${d}" ; ) \
-	} > nsImgBuildDefines.tmp
-	@if `cmp -s nsImgBuildDefines.h nsImgBuildDefines.tmp`; then \
-		rm -f nsImgBuildDefines.tmp; \
-	else \
-		rm -f nsImgBuildDefines.h; \
-		mv nsImgBuildDefines.tmp nsImgBuildDefines.h; \
-	fi
-
 include $(topsrcdir)/config/rules.mk
 
diff --git a/modules/libpr0n/build/nsImageModule.cpp b/modules/libpr0n/build/nsImageModule.cpp
--- a/modules/libpr0n/build/nsImageModule.cpp
+++ b/modules/libpr0n/build/nsImageModule.cpp
@@ -32,18 +32,16 @@
  * use your version of this file under the terms of the MPL, indicate your
  * decision by deleting the provisions above and replace them with the notice
  * and other provisions required by the GPL or the LGPL. If you do not delete
  * the provisions above, a recipient may use your version of this file under
  * the terms of any one of the MPL, the GPL or the LGPL.
  *
  * ***** END LICENSE BLOCK ***** */
 
-#include "nsImgBuildDefines.h"
-
 #include "nsIDeviceContext.h"
 #include "mozilla/ModuleUtils.h"
 #include "nsXPCOMCID.h"
 #include "nsServiceManagerUtils.h"
 
 #include "RasterImage.h"
 
 /* We end up pulling in windows.h because we eventually hit gfxWindowsSurface;
@@ -55,85 +53,57 @@
 #undef LoadImage
 
 #include "imgLoader.h"
 #include "imgRequest.h"
 #include "imgRequestProxy.h"
 #include "imgTools.h"
 #include "DiscardTracker.h"
 
-#ifdef IMG_BUILD_ENCODER_png
-// png
 #include "nsPNGEncoder.h"
-#endif
-#ifdef IMG_BUILD_ENCODER_jpeg
-// jpeg
 #include "nsJPEGEncoder.h"
-#endif
 
 // objects that just require generic constructors
 namespace mozilla {
 namespace imagelib {
 NS_GENERIC_FACTORY_CONSTRUCTOR(RasterImage)
 }
 }
 using namespace mozilla::imagelib;
 
 NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(imgLoader, Init)
 NS_GENERIC_FACTORY_CONSTRUCTOR(imgRequestProxy)
 NS_GENERIC_FACTORY_CONSTRUCTOR(imgTools)
-
-#ifdef IMG_BUILD_ENCODER_jpeg
-// jpeg
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsJPEGEncoder)
-#endif
-
-#ifdef IMG_BUILD_ENCODER_png
-// png
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsPNGEncoder)
-#endif
-
 NS_DEFINE_NAMED_CID(NS_IMGLOADER_CID);
 NS_DEFINE_NAMED_CID(NS_IMGREQUESTPROXY_CID);
 NS_DEFINE_NAMED_CID(NS_IMGTOOLS_CID);
 NS_DEFINE_NAMED_CID(NS_RASTERIMAGE_CID);
-#ifdef IMG_BUILD_ENCODER_jpeg
 NS_DEFINE_NAMED_CID(NS_JPEGENCODER_CID);
-#endif
-#ifdef IMG_BUILD_ENCODER_png
 NS_DEFINE_NAMED_CID(NS_PNGENCODER_CID);
-#endif
-
 
 static const mozilla::Module::CIDEntry kImageCIDs[] = {
   { &kNS_IMGLOADER_CID, false, NULL, imgLoaderConstructor, },
   { &kNS_IMGREQUESTPROXY_CID, false, NULL, imgRequestProxyConstructor, },
   { &kNS_IMGTOOLS_CID, false, NULL, imgToolsConstructor, },
   { &kNS_RASTERIMAGE_CID, false, NULL, RasterImageConstructor, },
-#ifdef IMG_BUILD_ENCODER_jpeg
   { &kNS_JPEGENCODER_CID, false, NULL, nsJPEGEncoderConstructor, },
-#endif
-#ifdef IMG_BUILD_ENCODER_png
   { &kNS_PNGENCODER_CID, false, NULL, nsPNGEncoderConstructor, },
-#endif
   { NULL }
 };
 
 static const mozilla::Module::ContractIDEntry kImageContracts[] = {
   { "@mozilla.org/image/cache;1", &kNS_IMGLOADER_CID },
   { "@mozilla.org/image/loader;1", &kNS_IMGLOADER_CID },
   { "@mozilla.org/image/request;1", &kNS_IMGREQUESTPROXY_CID },
   { "@mozilla.org/image/tools;1", &kNS_IMGTOOLS_CID },
   { "@mozilla.org/image/rasterimage;1", &kNS_RASTERIMAGE_CID },
-#ifdef IMG_BUILD_ENCODER_jpeg
   { "@mozilla.org/image/encoder;2?type=image/jpeg", &kNS_JPEGENCODER_CID },
-#endif
-#ifdef IMG_BUILD_ENCODER_png
   { "@mozilla.org/image/encoder;2?type=image/png", &kNS_PNGENCODER_CID },
-#endif
   { NULL }
 };
 
 static const mozilla::Module::CategoryEntry kImageCategories[] = {
   { "Gecko-Content-Viewers", "image/gif", "@mozilla.org/content/document-loader-factory;1" },
   { "Gecko-Content-Viewers", "image/jpeg", "@mozilla.org/content/document-loader-factory;1" },
   { "Gecko-Content-Viewers", "image/pjpeg", "@mozilla.org/content/document-loader-factory;1" },
   { "Gecko-Content-Viewers", "image/jpg", "@mozilla.org/content/document-loader-factory;1" },
