--- config/autoconf.mk.in.orig	2007-08-03 22:02:32.000000000 +0200
+++ config/autoconf.mk.in	2007-08-03 22:07:00.000000000 +0200
@@ -58,14 +58,14 @@
 prefix		= @prefix@
 exec_prefix	= @exec_prefix@
 bindir		= @bindir@
-includedir	= @includedir@/$(MOZ_APP_NAME)-$(MOZ_APP_VERSION)
+includedir	= @includedir@/$(MOZ_APP_NAME)
 libdir		= @libdir@
 datadir		= @datadir@
 mandir		= @mandir@
-idldir		= $(datadir)/idl/$(MOZ_APP_NAME)-$(MOZ_APP_VERSION)
+idldir		= $(includedir)/idl
 
-installdir	= $(libdir)/$(MOZ_APP_NAME)-$(MOZ_APP_VERSION)
-sdkdir		= $(libdir)/$(MOZ_APP_NAME)-devel-$(MOZ_APP_VERSION)
+installdir	= $(libdir)/$(MOZ_APP_NAME)
+sdkdir		= $(libdir)/$(MOZ_APP_NAME)
 
 DIST		= $(DEPTH)/dist
 LIBXUL_SDK      = @LIBXUL_SDK@
--- xulrunner/installer/mozilla-nspr.pc.in.orig	2007-08-03 22:37:09.000000000 +0200
+++ xulrunner/installer/mozilla-nspr.pc.in	2007-08-03 22:39:23.000000000 +0200
@@ -1,11 +1,6 @@
-prefix=%prefix%
-sdkdir=%sdkdir%
-includedir=%includedir%
-
 Name: NSPR
 Description: The Netscape Portable Runtime
 Version: %NSPR_VERSION%
-Libs: %FULL_NSPR_LIBS%
-Cflags: %FULL_NSPR_CFLAGS%
+Requires: %NSPR_NAME% >= %NSPR_VERSION%
 
 
--- xulrunner/installer/mozilla-nss.pc.in.orig	2007-08-03 22:37:14.000000000 +0200
+++ xulrunner/installer/mozilla-nss.pc.in	2007-08-03 22:40:43.000000000 +0200
@@ -1,10 +1,4 @@
-prefix=%prefix%
-sdkdir=%sdkdir%
-includedir=%includedir%
-
 Name: NSS
 Description: Mozilla Network Security Services
-Version: %MOZILLA_VERSION%
-Requires: %NSPR_NAME% >= %NSPR_VERSION%
-Libs: -L${sdkdir}/lib -lnss3 -lsmime3 -lssl3 -lsoftokn3
-Cflags: -I${includedir}/stable
+Version: %NSS_VERSION%
+Requires: %NSS_NAME% >= %NSS_VERSION%
--- xulrunner/installer/Makefile.in.orig	2007-08-04 14:42:06.000000000 +0200
+++ xulrunner/installer/Makefile.in	2007-08-04 14:44:54.000000000 +0200
@@ -66,7 +66,7 @@
 
 INSTALL_SDK = 1
 
-include $(topsrcdir)/toolkit/mozapps/installer/packager.mk
+#include $(topsrcdir)/toolkit/mozapps/installer/packager.mk
 
 # Add pkg-config files to the install:: target
 
@@ -80,6 +80,7 @@
 ifdef MOZ_NATIVE_NSPR
 NSPR_NAME=nspr
 NSPR_VERSION=$(shell $(NSPR_CONFIG) --version)
+pkg_config_files += mozilla-nspr.pc
 else
 pkg_config_files += mozilla-nspr.pc
 NSPR_NAME=mozilla-nspr
@@ -90,8 +92,10 @@
 
 $(warning FULL_NSPR_CFLAGS=$(FULL_NSPR_CFLAGS))
 
-ifndef MOZ_NATIVE_NSS
+ifdef MOZ_NATIVE_NSS
 pkg_config_files += mozilla-nss.pc
+NSS_VERSION=$(shell $(NSS_CONFIG) --version)
+NSS_NAME=nss
 endif
 
 %.pc: $(srcdir)/%.pc.in Makefile.in Makefile $(DEPTH)/config/autoconf.mk
@@ -105,13 +109,15 @@
 	-e "s|%FULL_NSPR_LIBS%|$(FULL_NSPR_LIBS)|" \
 	-e "s|%FULL_NSPR_CFLAGS%|$(FULL_NSPR_CFLAGS)|" \
 	-e "s|%NSPR_NAME%|$(NSPR_NAME)|" \
-	-e "s|%NSPR_VERSION%|$(NSPR_VERSION)|" > $@
+	-e "s|%NSPR_VERSION%|$(NSPR_VERSION)|" \
+	-e "s|%NSS_NAME%|$(NSS_NAME)|" \
+	-e "s|%NSS_VERSION%|$(NSS_VERSION)|" \
+	-e "s|\(^Libs: -L.*\)|\1 -Wl,-R\$$\{sdkdir}|" > $@
 	chmod 644 $@
 
 install:: $(pkg_config_files)
 	@echo pkg_config_file: $(pkg_config_files)
 	$(SYSINSTALL) $(IFLAGS1) $^ $(DESTDIR)$(libdir)/pkgconfig
 
 GARBAGE += $(MOZILLA_VERSION).system.conf $(pkg_config_files)

-libs:: make-sdk
