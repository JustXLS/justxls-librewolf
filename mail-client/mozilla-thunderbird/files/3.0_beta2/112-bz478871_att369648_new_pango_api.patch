---
 mozilla/gfx/thebes/src/gfxPangoFonts.cpp |   21 +++++++++++++++++++--
 1 file changed, 19 insertions(+), 2 deletions(-)

Index: mozilla/mozilla/gfx/thebes/src/gfxPangoFonts.cpp
===================================================================
--- mozilla.orig/mozilla/gfx/thebes/src/gfxPangoFonts.cpp
+++ mozilla/mozilla/gfx/thebes/src/gfxPangoFonts.cpp
@@ -1832,18 +1832,35 @@
 
     PangoFcFontMapClass *fcfontmap_class = PANGO_FC_FONT_MAP_CLASS (klass);
     fcfontmap_class->get_resolution = gfx_pango_font_map_get_resolution;
     // context_key_* virtual functions are only necessary if we want to
     // dynamically respond to changes in the screen cairo_font_options_t.
 
     // context_substitute and get_font are not likely to be used but
     //   implemented because the class makes them available.
-    fcfontmap_class->context_substitute = gfx_pango_font_map_context_substitute;
-    fcfontmap_class->create_font = gfx_pango_font_map_create_font;
+    if (pango_version() < PANGO_VERSION_ENCODE(1,23,0)) {
+        // Since gfx has the implementation of fontmap->get_resolution,
+        // fontset->get_font and fontset->foreach, these callback
+        // aren't necesscarry if pango >= 1.23
+#if PANGO_VERSION_CHECK(1,23,0)
+        // From 1.23, these callback defines are changed.
+        // fontset_key_subtitute (from 1.23) and context_substitue (until 1.22)
+        // is same offset
+        fcfontmap_class->fontset_key_substitute =
+            (void (*)(PangoFcFontMap*, PangoFcFontsetKey*, FcPattern*))
+                gfx_pango_font_map_context_substitute;
+        fcfontmap_class->create_font =
+            (PangoFcFont* (*)(PangoFcFontMap*, PangoFcFontKey*))
+                gfx_pango_font_map_create_font;
+#else
+        fcfontmap_class->context_substitute = gfx_pango_font_map_context_substitute;
+        fcfontmap_class->create_font = gfx_pango_font_map_create_font;
+#endif
+    }
 }
 
 /**
  ** gfxPangoFontGroup
  **/
 
 struct FamilyCallbackData {
     FamilyCallbackData(nsTArray<nsString> *aFcFamilyList,
